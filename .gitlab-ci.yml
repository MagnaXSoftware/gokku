image: golang:1.11

stages:
  - build
  - release

build_client:
  stage: build
  script:
    - cd client
    - go build -o gokku .
  only:
    - branches

.release_client: &release_client
  stage: release
  script:
    - cd client
    - go get github.com/mitchellh/gox
    - gox -arch="${BUILD_ARCH}" -output="build/gokku-{{.OS}}-{{.Arch}}" .
  only:
    refs:
      - tags
      - /^client\/.*$/
  artifacts:
    paths:
      - client/build/*

release_client_amd64:
  <<: *release_client
  before_script:
    - export BUILD_ARCH=amd64

release_client_386:
  <<: *release_client
  before_script:
    - export BUILD_ARCH=386

release_client_arm:
  <<: *release_client
  before_script:
    - export BUILD_ARCH=arm